% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sf.operator.R
\name{step_compartments}
\alias{step_compartments}
\title{Screen number of compartments from the current/baseline model}
\usage{
step_compartments(
  dat,
  state,
  search.space,
  param_table,
  penalty.control = NULL,
  precomputed_results_file = NULL,
  filename = NULL,
  ...
)
}
\arguments{
\item{dat}{A pharmacokinetic dataset passed through to \code{sf.mod.run()}.}

\item{state}{A list-like state that may contain:
\itemize{
\item \code{best_code}: named integer vector for the current model code (may be \code{NULL})
\item \code{modi}: optional value forwarded to \code{sf.mod.run()} (if absent, defaults to 1)
}}

\item{search.space}{Character scalar, e.g. \code{"ivbase"} or \code{"oralbase"}.}

\item{param_table}{Object passed through to \code{sf.mod.run()}.}

\item{...}{Additional arguments forwarded to \code{sf.mod.run()}. Must include
\code{custom_base} (a numeric vector) used by \code{base_model()} to
initialize the starting code when \code{state$best_code} is \code{NULL}.}
}
\value{
A list with:
\itemize{
\item \code{results_table}: \code{data.frame} with columns
\code{Step}, \code{"Model name"}, \code{"Model code"}, \code{Fitness}
\item \code{best_code}: named integer vector of the best candidateâ€™s model code
\item \code{best_row}: one-row \code{data.frame} (the best candidate)
}
}
\description{
Clones the current model code (from \code{state$best_code}, or from
\code{base_model(search.space, custom_base = ...)} if \code{state$best_code}
is \code{NULL}) and generates three candidates by setting
\code{no.cmpt} to 1, 2, and 3 while keeping all other positions unchanged.
Each candidate is evaluated with \code{sf.mod.run()} and the best (lowest
\code{Fitness}) is returned alongside a results table for logging.
}
\details{
Candidates are formed by copying the starting code and changing only the
\code{no.cmpt} element to \{1, 2, 3\}. Named codes are converted to unnamed
numeric vectors (\code{unname()}) when passed to \code{sf.mod.run()}.
If \code{state$modi} is \code{NULL}, a default of \code{1} is used.
}
\examples{
# Initialize state (if needed)
# Run the compartment screening (custom_base is required and forwarded via ...):
res <- step_compartments(
 dat = dat,
 state = state,
 search.space = "ivbase",
 param_table = param_table,
 saem.control = saemControl(nBurn = 10,nEm = 10),
 table.control = tableControl(cwres = T)
)

# Log both all candidates and the best candidate, and update state$best_code:
state <- modlog_state(state, results_table = res$results_table, step_name = "no. of compartments")

}
