% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sf.operator.R
\name{step_iiv}
\alias{step_iiv}
\title{Stepwise inclusion of inter-individual variability (IIV)}
\usage{
step_iiv(
  dat,
  state = list(),
  search.space = "ivbase",
  param_table = NULL,
  penalty.control = NULL,
  precomputed_results_file = NULL,
  filename = NULL,
  ...
)
}
\arguments{
\item{dat}{Data frame passed to \code{mod.run()}.}

\item{state}{List-like object with:
\itemize{
\item \code{best_code}: starting named integer/numeric vector; if \code{NULL}, \code{base_model()} is used.
\item \code{modi}: optional; forwarded to \code{mod.run()} (default \code{1L}).
}}

\item{search.space}{Character scalar: \code{"ivbase"} or \code{"oralbase"}.}

\item{param_table}{Parameter table passed to \code{mod.run()}.}

\item{penalty.control}{Optional penalty control object passed to \code{mod.run()}.}

\item{...}{Additional arguments forwarded to \code{mod.run()}. May include
\code{custom_base} for \code{base_model()} when \code{state$best_code} is \code{NULL}.}
}
\value{
A list with:
\itemize{
\item \code{results_table}: \code{data.frame} with columns Step, Model name, Model code, Fitness.
\item \code{best_code}: final best model code (named integer vector).
\item \code{best_row}: one-row \code{data.frame} for the best entry.
}
}
\description{
Two-stage procedure:
\enumerate{
\item Special IIV:
\itemize{
\item If \code{mm = 1} and \code{eta.km = 0}, test \code{eta.km = 1}.
\item If \code{search.space = "oralbase"} and \code{eta.ka = 0}, test \code{eta.ka = 1}.
}
\item Structural IIV (forward selection):
\itemize{
\item 1-compartment: \code{eta.vc}
\item 2-compartment: \code{eta.vc, eta.vp, eta.q}
\item 3-compartment: \code{eta.vc, eta.vp, eta.q, eta.vp2, eta.q2}
At each iteration, turn exactly one available IIV from 0 to 1, evaluate all candidates,
accept the single best improvement, and stop when no improvement occurs.
}
}
}
\examples{
\dontrun{

dat <- pheno_sd
param_table <-   param_table<-auto_param_table(dat = dat,
                                param_table = param_table,
                                nlmixr2autoinits = T)
results_iiv <- step_iiv(
 dat = dat,
 state = list(),
 search.space = "ivbase",
 param_table = param_table,
 penalty.control =   penalty.control
)

results_iiv$results_table
results_iiv$best_code
results_iiv$best_row
}

}
