% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_model_in_subprocess.R
\name{run_model_in_subprocess}
\alias{run_model_in_subprocess}
\title{Run an nlmixr2 model in an isolated subprocess}
\usage{
run_model_in_subprocess(
  modi,
  dat,
  f,
  saem.control = NULL,
  table.control = NULL,
  max_errors = 100,
  max_wall_time = 86400,
  verbose = TRUE
)
}
\arguments{
\item{modi}{Integer. A model index used to generate unique temporary filenames.}

\item{dat}{A data frame containing the dataset used in nlmixr2 model fitting.}

\item{f}{An nlmixr2 model function (e.g., generated by \code{ppkmodGen(..., return.func = TRUE)}).}

\item{saem.control}{A \code{saemControl()} object providing estimation settings.}

\item{table.control}{A \code{tableControl()} object controlling table output behavior.}

\item{max_errors}{Integer. Maximum number of detected error messages before
forcibly terminating the subprocess. Default is 100.}

\item{max_wall_time}{Numeric (seconds). Maximum allowed real (wall-clock)
time for the subprocess before termination. Default is 86400 (24 hours).}

\item{verbose}{Logical. If TRUE, progress and diagnostic messages are
printed during subprocess monitoring. Default is TRUE.}
}
\value{
A list with:
\describe{
\item{fit.s}{The fitted nlmixr2 object, or NULL if the subprocess failed.}
\item{loadError}{Logical indicating whether an error occurred (including timeout or crash).}
}
}
\description{
This function executes an nlmixr2 model fitting procedure in a separate
background R session using the \pkg{processx} backend.
Running the model in an isolated subprocess prevents the main R session from
crashing and allows monitoring errors, wall-time limits, and controlled output.
}
\details{
Temporary files are created to pass model components (\code{f}, \code{dat},
\code{saem.control}, \code{table.control}) to the subprocess and to retrieve the fitted
model object.

The function uses \pkg{processx} to execute a temporary R script in a clean R
process. This provides isolation from instabilities that may arise during
long-running nlmixr2/SAEM estimation routines, as well as from poorly
specified or unstable models that can otherwise cause the main R session to
crash. Running each fit in a separate subprocess helps ensure that estimation
failures remain contained and do not interrupt the user's primary workflow.

Error messages emitted by the subprocess are monitored in real time, and the
process is automatically terminated if:
\enumerate{
\item Too many errors are detected (\code{max_errors});
\item The wall-time limit (\code{max_wall_time}) is exceeded
}
}
\examples{
# Example: run a simple nlmixr2 model
pheno <- function() {
  ini({
    tcl <- log(0.008)     # typical clearance
    tv  <- log(0.6)       # typical volume
    eta.cl + eta.v ~ c(1,
                       0.01, 1)  # interindividual variability
    add.err <- 0.1        # residual variability
  })

  model({
    cl <- exp(tcl + eta.cl)
    v  <- exp(tv  + eta.v)
    ke <- cl / v
    d/dt(A1) = -ke * A1
    cp = A1 / v
    cp ~ add(add.err)
  })
}
\donttest{
 run_model_in_subprocess(
    modi = 1,
    dat = pheno_sd,
    f = pheno,
    saem.control = saemControl(
      seed = 1234,
      nBurn = 100,
      nEm = 100,
      logLik = TRUE
    )
  )
}
}
